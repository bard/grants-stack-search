<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@picocss/pico@1.5.7/css/pico.min.css"
    />
    <title>Projects</title>
    <script src="https://unpkg.com/nunjucks@3.1.7/browser/nunjucks.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5/dist/ext/client-side-templates.js"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5/dist/ext/json-enc.js"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5/dist/ext/debug.js"></script>

    <style type="text/css">
      @media (min-width: 1200px) {
        body > footer,
        body > header,
        body > main,
        section {
          /* halve excessive spacing in default style for large screens */
          --block-spacing-vertical: calc(var(--spacing) * 2);
        }
      }

      .responsive-grid {
        max-width: 1200px;
        display: grid;
        column-gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
      }

      article.project-summary {
        height: 20rem;
        overflow: hidden;
        font-size: 12px;
        position: relative;
      }

      article.project-summary > header {
        background-size: cover;
        height: calc(var(--block-spacing-vertical) * 2);
      }

      article.project-summary .fade-out {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        text-align: center;
        margin: 0;
        padding: 40px 0;
        background-image: linear-gradient(to bottom, transparent, #fff);
      }

      article.project > header {
        background-size: cover;
        height: calc(var(--block-spacing-vertical) * 8);
      }

      section.similar-projects {
        margin-top: calc(var(--block-spacing-vertical) * 2);
      }

      section.similar-projects > h3 {
        text-align: center;
      }

      details.inspect {
        font-size: 75%;
        font-family: monospace;
      }

      details.inspect pre {
        white-space: pre-wrap;
      }
    </style>
  </head>

  <body hx-ext="client-side-templates">
    <main class="container">
      <section>
        <div class="grid">
          <div>
            <input
              type="search"
              autofocus
              name="q"
              placeholder="Semantic search..."
              autocomplete="off"
              hx-get="/semantic-search"
              hx-trigger="keyup changed delay:0.5s"
              hx-target="#projects"
              nunjucks-template="project-list-tmpl"
            />
          </div>

          <div>
            <input
              type="search"
              autofocus
              name="q"
              placeholder="Full text search..."
              autocomplete="off"
              hx-get="/fulltext-search"
              hx-trigger="keyup changed delay:0.5s"
              hx-target="#projects"
              nunjucks-template="project-list-tmpl"
            />
          </div>
        </div>
        <div style="text-align: center">
          Categories:

          <a
            href="#"
            hx-get="/semantic-search?q=open+source"
            hx-target="#projects"
            nunjucks-template="project-list-tmpl"
          >
            open source</a
          >,

          <a
            href="#"
            hx-get="/semantic-search?q=AI"
            hx-target="#projects"
            nunjucks-template="project-list-tmpl"
          >
            AI</a
          >,

          <a
            href="#"
            hx-get="/semantic-search?q=public+goods"
            hx-target="#projects"
            nunjucks-template="project-list-tmpl"
          >
            public goods</a
          >,

          <a
            href="#"
            hx-get="/semantic-search?q=nft"
            hx-target="#projects"
            nunjucks-template="project-list-tmpl"
          >
            NFTs</a
          >,

          <a
            href="#"
            hx-get="/semantic-search?q=education"
            hx-target="#projects"
            nunjucks-template="project-list-tmpl"
          >
            education</a
          >
        </div>
      </section>

      <section id="projects"></section>

      <template id="project-list-tmpl">
        {% if results | length %}

        <div class="responsive-grid">
          {% for p in results %}

          <article class="project-summary">
            <header
              style="background-image: url({{ p.banner_image_url }})"
            ></header>
            <h5>
              <a
                href="#project"
                hx-get="/projects/{{ p.id }}"
                hx-target="#project"
                nunjucks-template="project-tmpl"
              >
                {{ p.name }}
              </a>
            </h5>
            <div>{{ p.description }}</div>
            <div class="fade-out"></div>
          </article>

          {% endfor %}
        </div>

        <details class="inspect">
          <summary>Inspect API results for this search...</summary>
          <pre>{{ results | dump(2) }}</pre>
        </details>

        {% endif %}

        <div id="project"></div>
      </template>

      <template id="project-tmpl">
        <article class="project">
          <header
            style="background-image: url({{ banner_image_url }});"
          ></header>

          <h2>{{ name }}</h2>

          <div>{{ description_html | safe }}</div>
        </article>

        <section class="similar-projects">
          <h3>Explore similar projects:</h3>
          <div
            hx-trigger="load"
            hx-get="/semantic-search?q={{ description }}"
            nunjucks-template="project-list-tmpl"
          ></div>
        </section>
      </template>
    </main>
  </body>
</html>
