<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@picocss/pico@1.5.7/css/pico.min.css"
    />
    <title>Projects</title>
    <script src="https://unpkg.com/nunjucks@3.1.7/browser/nunjucks.min.js"></script>
    <script src="https://unpkg.com/htmx.org"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/client-side-templates.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/response-targets.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/debug.js"></script>

    <style type="text/css">
      @media (min-width: 1200px) {
        body > footer,
        body > header,
        body > main,
        section {
          /* halve excessive spacing in default style for large screens */
          --block-spacing-vertical: calc(var(--spacing) * 2);
        }
      }

      .responsive-grid {
        max-width: 1200px;
        display: grid;
        column-gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
      }

      article.project-summary {
        height: 20rem;
        overflow: hidden;
        font-size: 12px;
        position: relative;
        margin-top: calc(var(--block-spacing-vertical) * 0.125);
      }

      article.project-summary > header {
        background-size: cover;
        height: calc(var(--block-spacing-vertical) * 2);
      }

      article.project-summary .fade-out {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        text-align: center;
        margin: 0;
        padding: 40px 0;
        background-image: linear-gradient(to bottom, transparent, #fff);
      }

      article.project > header {
        background-size: cover;
        height: calc(var(--block-spacing-vertical) * 8);
      }

      section.similar-projects {
        margin-top: calc(var(--block-spacing-vertical) * 2);
      }

      section.similar-projects > h3 {
        text-align: center;
      }

      details.inspect pre {
        font-size: 75%;
        white-space: pre-wrap;
        padding: 1em;
      }

      .examples code,
      .examples dd {
        font-size: 60%;
      }
      dd {
        margin-top: calc(var(--block-spacing-vertical) * 0.25);
        margin-bottom: calc(var(--block-spacing-vertical) * 0.25);
      }
    </style>
  </head>

  <body hx-ext="client-side-templates,response-targets">
    <main class="container">
      <section>
        <input
          type="search"
          autofocus
          name="q"
          placeholder="Search..."
          autocomplete="off"
          hx-get="/search"
          hx-target="#projects"
          hx-target-400="#projects"
          nunjucks-template="project-list-tmpl"
        />

        <details
          class="examples"
          hx-target="#projects"
          hx-target-400="#projects"
          nunjucks-template="project-list-tmpl"
        >
          <summary>Examples</summary>

          <dl>
            <dt>
              <code>
                <a
                  href="#"
                  hx-get="/search?q=open%20source%20--strategy%3Dsemantic"
                  >open source --strategy=semantic</a
                >
              </code>

              <code>
                <a href="#" hx-get="/search?q=AI%20--strategy%3Dsemantic"
                  >AI --strategy=semantic</a
                >
              </code>

              <code>
                <a href="#" hx-get="/search?q=education%20--strategy%3Dsemantic"
                  >education --strategy=semantic</a
                >
              </code>
            </dt>
            <dd>
              Use semantic search to simulate categories. Can only be used in
              links as it requires setting the search type ahead of time instead
              of guessing it from the content of the query.
            </dd>

            <dt>
              <code>
                <a
                  href="#"
                  hx-get="/search?q=black%20hare%20--strategy%3Dhybrid%20--hybrid-search-fulltext-std-dev-factor%3D3"
                  >black hare --strategy=hybrid
                  --hybrid-search-fulltext-std-dev-factor=3</a
                >
              </code>
            </dt>
            <dd>
              When the fulltext side of a hybrid search returns more than 2
              results, only the outliers are used from it. Outliers are defined
              as all results above N standard deviations from the median, with
              N=3 by default. Higher values mean fewer results.
            </dd>

            <dt>
              <code>
                <a
                  href="#"
                  hx-get="/search?q=black%20hare%20--strategy%3Dhybrid%20--hybrid-search-fulltext-std-dev-factor%3D1"
                  >black hare --strategy=hybrid
                  --hybrid-search-fulltext-std-dev-factor=1</a
                >
              </code>
            </dt>
            <dd>
              Use more results from the fulltext side by decreasing the standard
              deviation factor.
            </dd>

            <dt>
              <code>
                <a href="#" hx-get="/search?q=blck%20hare%20--strategy%3Dhybrid"
                  >blck hare --strategy=hybrid</a
                >
              </code>
            </dt>
            <dd>Both strategies have a degree of resistance to typos.</dd>

            <dt>
              <code>
                <a
                  href="#"
                  hx-get="/search?q=black%20hare%20--strategy%3Dhybrid%20--hybrid-search-semantic-score-cutoff%3D0.1"
                  >black hare --strategy=hybrid
                  --hybrid-search-semantic-score-cutoff=0.1</a
                >
              </code>
            </dt>
            <dd>
              Use more results from the semantic side by decreasing the minimum
              relevance score a result has to have. Default is 0.35. Example
              shows the drawback of selecting too low a score.
            </dd>
          </dl>
        </details>
      </section>

      <section id="projects"></section>

      <template id="project-list-tmpl">
        {% if detail is string %}
        <article>
          <pre><code>{{ detail }}</code></pre>
        </article>
        {% elif results | length %}

        <div class="responsive-grid">
          {% for p in results %}

          <article class="project-summary">
            <header
              style="background-image: url({{ p.banner_image_url }})"
            ></header>
            <h5>
              <a
                href="#project"
                hx-get="/projects/{{ p.project_id }}"
                hx-target="#project"
                nunjucks-template="project-tmpl"
              >
                {{ p.name }}
              </a>
            </h5>
            <div>{{ p.description_plain }}</div>
            <div class="fade-out"></div>
          </article>

          {% endfor %}
        </div>

        <details class="inspect">
          <summary>API response</summary>
          <h5>Results</h5>
          <pre>{{ results | dump(2) }}</pre>
          <h5>Debug</h5>
          <pre>{{ debug | dump(2) }}</pre>
        </details>

        {% else %}

        <p>{{ detail }}</p>
        <p>No results found. :(</p>

        {% endif %}

        <div id="project"></div>
      </template>

      <template id="project-tmpl">
        <article class="project">
          <header
            style="background-image: url({{ banner_image_url }});"
          ></header>

          <h2>{{ name }}</h2>

          <div>{{ description_html | safe }}</div>
        </article>

        <section class="similar-projects">
          <h3>Explore similar projects:</h3>
          <div
            hx-trigger="load"
            hx-get="/semantic-search?q={{ description_plain }}"
            nunjucks-template="project-list-tmpl"
          ></div>
        </section>
      </template>
    </main>

    <script>
      document.querySelector(".examples").addEventListener(
        "click",
        (e) => {
          if (e.target.tagName === "A") {
            document.querySelector("input[type=search]").value =
              e.target.textContent.replace(/\s+/g, " ");
          }
        },
        false,
      );
    </script>
  </body>
</html>
